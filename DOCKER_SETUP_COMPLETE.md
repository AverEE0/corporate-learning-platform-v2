# ‚úÖ Docker Setup - –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ

### 1. Dockerfile ‚úÖ
- –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Next.js standalone —Ä–µ–∂–∏–º–æ–º
- –î–æ–±–∞–≤–ª–µ–Ω—ã build –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (python3, make, g++)
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω curl –¥–ª—è health checks

### 2. docker-compose.yml ‚úÖ
- –£–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—É–¥–∞–ª–µ–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π nginx)
- –î–æ–±–∞–≤–ª–µ–Ω `extra_hosts` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î –Ω–∞ —Ö–æ—Å—Ç–µ —á–µ—Ä–µ–∑ `host.docker.internal`
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ volumes –¥–ª—è uploads –∏ logs
- Health check –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å curl
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `.env.local` —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3. .env.example ‚úÖ
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `ENV_EXAMPLE.txt` (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ `.env.local`)
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è Docker –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 4. .dockerignore ‚úÖ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
- –ò—Å–∫–ª—é—á–µ–Ω—ã –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (node_modules, .next, –ª–æ–≥–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

### 5. lib/database.ts ‚úÖ
- –£–ª—É—á—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ connection pool
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ –ª–∏–º–∏—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### 6. next.config.js ‚úÖ
- –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `output: 'standalone'` –¥–ª—è Docker

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ .env.local

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`:

```bash
cd /root/corporate-learning-platform-v2
cp ENV_EXAMPLE.txt .env.local
nano .env.local
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:**
```
DATABASE_URL=postgresql://postgres:password@host.docker.internal:5432/learning_platform
JWT_SECRET=<—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–∫–ª—é—á>
NEXT_PUBLIC_APP_URL=https://ykz.tw1.ru
```

**–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT_SECRET:**
```bash
openssl rand -base64 32
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
cd /root/corporate-learning-platform-v2
docker compose up -d --build
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f app

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
curl http://localhost:3044/api/health
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **DATABASE_URL –¥–ª—è Docker**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `host.docker.internal` –≤–º–µ—Å—Ç–æ `localhost` –µ—Å–ª–∏ –ë–î –Ω–∞ —Ö–æ—Å—Ç–µ
2. **–ü–æ—Ä—Ç**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3044 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ docker-compose.yml)
3. **Volumes**: `uploads` –∏ `logs` –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ volumes, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ
4. **Nginx**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π nginx –Ω–∞ —Ö–æ—Å—Ç–µ (–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ docker-compose)

## –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose restart app

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker compose down
docker compose build --no-cache
docker compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f app

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose exec app sh
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
corporate-learning-platform-v2/
‚îú‚îÄ‚îÄ Dockerfile                  ‚úÖ –ì–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ docker-compose.yml          ‚úÖ –ì–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ .dockerignore              ‚úÖ –ì–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ ENV_EXAMPLE.txt            ‚úÖ –ì–æ—Ç–æ–≤ (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ .env.local)
‚îú‚îÄ‚îÄ DOCKER_DEPLOYMENT.md       ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ DOCKER_READY.md            ‚úÖ –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îî‚îÄ‚îÄ DOCKER_SETUP_COMPLETE.md   ‚úÖ –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é! üöÄ

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ Docker. –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤—ã—à–µ.


