# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
cd /root/corporate-learning-platform-v2
chmod +x diagnose-server.sh
./diagnose-server.sh
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –®–∞–≥ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```bash
chmod +x fix-server.sh
./fix-server.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç `.env.local` –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- –°–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker logs -f corporate_learning_app

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker)
docker logs -f corporate_learning_db

# –í—Å–µ –ª–æ–≥–∏ docker-compose
docker compose logs -f
```

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `docker compose ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–∫ "Exited"
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 3044

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs corporate_learning_app

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose down
docker compose build --no-cache
docker compose up -d
```

### 2. –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `ECONNREFUSED` –∏–ª–∏ `Connection refused`
- –û—à–∏–±–∫–∏ —Ç–∏–ø–∞ `database "learning_platform" does not exist`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PostgreSQL –≤ Docker
docker compose up -d postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker exec corporate_learning_db pg_isready -U postgres

# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
docker exec -it corporate_learning_db psql -U postgres -c "CREATE DATABASE learning_platform;"

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker exec -it corporate_learning_db psql -U postgres -d learning_platform < scripts/01_create_database.sql
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤–Ω–µ—à–Ω—é—é –ë–î:**
```bash
# –û–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL –≤ .env.local
nano .env.local
# –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞: DATABASE_URL=postgresql://user:password@host:port/database

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose restart app
```

### 3. Health endpoint –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- `curl http://localhost:3044/api/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec corporate_learning_app curl http://localhost:3000/api/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec corporate_learning_app env | grep DATABASE_URL

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–±—Ä–æ—à–µ–Ω
docker port corporate_learning_app
```

### 4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (502/503 –æ—à–∏–±–∫–∞)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 502 Bad Gateway
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker compose ps

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
docker logs corporate_learning_app | tail -50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl -v http://localhost:3044/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose restart app
```

### 5. –û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ Next.js

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ `docker compose build`
- –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ "Module not found" –∏–ª–∏ "Build failed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
docker compose down
docker system prune -f
docker compose build --no-cache

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ next.config.js - –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
# output: 'standalone'
cat next.config.js | grep standalone
```

### 6. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–∞–º–∏ (uploads/logs)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ "Permission denied" –≤ –ª–æ–≥–∞—Ö
- –§–∞–π–ª—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la uploads/ logs/

# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞
chmod 755 uploads logs
chown -R $(whoami) uploads logs

# –í–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec corporate_learning_app ls -la /app/uploads
```

### 7. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `docker compose ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Restarting"
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ü–∏–∫–ª –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
docker logs corporate_learning_app --tail 100

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
docker compose stop app
docker run --rm -it --env-file .env.local corporate-learning-platform-v2-app sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker run --rm -it --env-file .env.local -p 3044:3000 corporate-learning-platform-v2-app node server.js
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ .env.local
```bash
cat .env.local
```

–î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```env
DATABASE_URL=postgresql://postgres:password@postgres:5432/learning_platform
JWT_SECRET=your-secret-key
NODE_ENV=production
PORT=3000
NEXT_PUBLIC_APP_URL=http://212.113.123.94:3044
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ docker-compose.yml
```bash
cat docker-compose.yml | grep -A 5 "ports:"
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```yaml
ports:
  - "3044:3000"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ next.config.js
```bash
cat next.config.js
```

–î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```javascript
output: 'standalone'
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f corporate_learning_app

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker compose restart app

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose down

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose up -d

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
docker compose down
docker compose build --no-cache
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker system prune -a
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –∏ –ø–æ—Ä—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
netstat -tuln | grep 3044
# –∏–ª–∏
ss -tuln | grep 3044

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–∑–≤–Ω–µ (–µ—Å–ª–∏ –ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç)
curl http://212.113.123.94:3044/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
iptables -L -n | grep 3044
# –∏–ª–∏ –¥–ª—è firewalld
firewall-cmd --list-ports
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker stats --no-stream

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
df -h
docker system df

# –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
journalctl -u docker -n 50
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `./diagnose-server.sh` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–≤–æ–¥
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥–∏: `docker logs corporate_learning_app > logs.txt`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏: `journalctl -u docker > system-logs.txt`

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –Ω—É–ª—è

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å –Ω—É–ª—è:

```bash
cd /root/corporate-learning-platform-v2

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down -v

# –£–¥–∞–ª–∏—Ç–µ –æ–±—Ä–∞–∑—ã
docker rmi corporate-learning-platform-v2-app || true

# –û—á–∏—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
docker system prune -a

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./fix-server.sh
```


