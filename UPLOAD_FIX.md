# Исправление ошибки 413 (Payload Too Large)

## Проблема
При загрузке файлов через `/api/upload` возникала ошибка 413, что означает, что файл слишком большой для загрузки.

## Решение

### 1. Обновлен Next.js конфиг (`next.config.js`)
- Увеличен лимит для serverActions до 100MB

### 2. Обновлены Nginx конфиги
- `nginx.conf`: `client_max_body_size` увеличен с 20M до 100M
- `nginx-ssl.conf`: `client_max_body_size` увеличен с 20M до 100M
- Добавлен `client_max_body_size 100M` в location `/api/upload` для надежности
- Увеличены таймауты для загрузки файлов до 300 секунд (5 минут)

### 3. Обновлен API route (`app/api/upload/route.ts`)
- Увеличен лимит проверки размера файла с 10MB до 100MB
- Добавлен `export const maxDuration = 300` для поддержки долгих загрузок

## Что нужно сделать на сервере

После применения изменений нужно:

1. **Перезапустить Docker контейнеры:**
```bash
docker compose restart
```

2. **Или перезагрузить Nginx (если используется отдельный Nginx):**
```bash
sudo nginx -t  # Проверить конфигурацию
sudo systemctl reload nginx  # Перезагрузить Nginx
```

3. **Пересобрать Next.js приложение (если нужно):**
```bash
docker compose exec app npm run build
docker compose restart app
```

## Текущие лимиты

- **Nginx**: 100MB
- **Next.js API route**: 100MB
- **Таймауты**: 300 секунд (5 минут)

## Примечание

Если нужно загружать файлы больше 100MB, можно увеличить лимиты до 500MB или 1GB, но это потребует:
- Больше памяти на сервере
- Больше времени на загрузку
- Возможно, настройку буферизации в Nginx

